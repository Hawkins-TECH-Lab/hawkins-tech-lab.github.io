<!DOCTYPE html>
<html lang="en"><head>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-html/tabby.min.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.8.25">

  <title>Hawkinslab â€“ Lecture 5 - Multinomial Logit</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../../../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../../../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
  </style>
  <link rel="stylesheet" href="../../../site_libs/revealjs/dist/theme/quarto-0fde88a82f0356838740f155f1088782.css">
  <link href="../../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../../../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../../../site_libs/revealjs/plugin/reveal-chalkboard/font-awesome/css/all.css" rel="stylesheet">
  <link href="../../../site_libs/revealjs/plugin/reveal-chalkboard/style.css" rel="stylesheet">
  <link href="../../../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Lecture 5 - Multinomial Logit</h1>
  <p class="subtitle">ENCI707: Engineering Demand and Policy Analysis</p>

<div class="quarto-title-authors">
</div>

</section>
<section id="outline" class="slide level2 smaller">
<h2>Outline</h2>
<ul>
<li class="fragment">Discrete multinomial choice - Type I EV Distribution</li>
<li class="fragment">Multinomial Logit (MNL) - Scale and Systematic Utility Function</li>
<li class="fragment">MNL Estimation &amp; Specification</li>
<li class="fragment">Elasticity, Marginal Effect, &amp; Substitution</li>
<li class="fragment">IIA &amp; IIA violation tests</li>
<li class="fragment">Policy Evaluation</li>
<li class="fragment">Forecasting &amp; Prediction</li>
<li class="fragment">Confidence Intervals on Predictions</li>
<li class="fragment">Model transferability &amp; Parameter Updating</li>
</ul>
</section>
<section>
<section id="discrete-choice-multinomial-choice---type-i-extreme-value-distribution" class="title-slide slide level1 center">
<h1>Discrete Choice Multinomial Choice - Type I Extreme Value Distribution</h1>

</section>
<section id="binary-versus-multinomial-choice" class="slide level2">
<h2>Binary versus Multinomial Choice</h2>

<img data-src="../../../assets/images/teaching/ENCI707/Lecture5/binary_multi_choice.svg" class="quarto-figure quarto-figure-center r-stretch"></section>
<section id="binary-versus-multinomial-choice-1" class="slide level2">
<h2>Binary versus Multinomial Choice</h2>

<img data-src="../../../assets/images/teaching/ENCI707/Lecture5/binary_multi_choice2.svg" class="quarto-figure quarto-figure-center r-stretch"></section>
<section id="discrete-multinomial-choice" class="slide level2 smaller">
<h2>Discrete Multinomial Choice</h2>
<p>A multinomial choice reduced into an equivalent binary choice problem:</p>
<p><img data-src="../../../assets/images/teaching/ENCI707/Lecture5/binary_multi_choice3.svg" class="absolute" style="top: 150px; left: 0px; "></p>
<p><span class="math display">\[ğ‘ˆ_ğ‘— \ge \max_{j,j' \in C_i, j \neq j'} U_{j'}\]</span> <span class="math display">\[ğ‘ˆ_ğ‘— \ge ğ‘ˆ_ğ‘˜ \text{; } k \neq j \text{ &amp; } j,k \in C_i\]</span></p>
<ul>
<li><p>where <span class="math inline">\(C_i\)</span> is the <strong>choice set</strong> of decision maker <span class="math inline">\(i\)</span>, <span class="math inline">\(j\)</span> is the <strong>best alternative</strong>, and <span class="math inline">\(k\)</span> is the <strong>second best</strong> alternative</p></li>
<li><p>Probability of choosing alternative j:</p></li>
</ul>
<p><span class="math display">\[Prâ¡(ğ‘—) = Prâ¡((ğ‘‰_ğ‘—+\epsilon_ğ‘—) \ge (ğ‘‰_ğ‘˜+\epsilon_ğ‘˜ ))\]</span> <span class="math display">\[Prâ¡( ğ‘—)=Prâ¡(\epsilon_ğ‘˜ \leq (ğ‘‰_ğ‘—âˆ’ğ‘‰_ğ‘˜+\epsilon_ğ‘— )) \text{ (a CDF function)}\]</span></p>
</section>
<section id="discrete-multinomial-choice-1" class="slide level2 smaller">
<h2>Discrete Multinomial Choice</h2>
<p>A multinomial choice reduced into an equivalen Choice probability in a multinomial choice context: <span class="math display">\[Prâ¡(ğ‘—)=Prâ¡(\epsilon_ğ‘˜ \leq (ğ‘‰_ğ‘—âˆ’ğ‘‰_ğ‘˜+\epsilon_ğ‘— ))\]</span></p>
<p>Probability distribution of random utility (<span class="math inline">\(\epsilon\)</span>) needs to be fully specified to get the unconditional probability: <span class="math display">\[Prâ¡(ğ‘—)=\int_{\epsilon_ğ‘—=âˆ’\infty}^{+\infty}\int_{\epsilon_ğ‘˜=âˆ’\infty}^{ğ‘‰_ğ‘—âˆ’ğ‘‰_ğ‘˜+\epsilon_ğ‘—} ğ‘“(\epsilon_ğ‘—,\epsilon_ğ‘˜)ğ‘‘ \epsilon_ğ‘— ğ‘‘ \epsilon_ğ‘˜\]</span></p>
<ul>
<li>Specification of univariate distribution, <span class="math inline">\(f(\epsilon_k)\)</span> , and the joint distribution, <span class="math inline">\(f(\epsilon_j,\epsilon_k)\)</span>, are necessary</li>
<li>Possible distributions:
<ul>
<li>Multivariate normal distribution</li>
<li>Type I Extreme Value distribution</li>
</ul></li>
</ul>
</section>
<section id="type-i-extreme-value-distribution" class="slide level2 smaller">
<h2>Type I Extreme Value Distribution</h2>
<ul>
<li>Type I (<strong>Gumbel</strong>) distribution is the most convenient distribution to derive a closed form choice model
<ul>
<li>If is Type I Extreme Value (Gumbel) distributed: <span class="math display">\[ğ‘“(\epsilon)=\mu ğ‘’^{âˆ’\mu(\epsilonâˆ’\eta)} ğ‘’^{âˆ’ğ‘’^{âˆ’\mu(\epsilonâˆ’\eta)}}\]</span> <span class="math display">\[F = e^{-e^{-\mu(\epsilon-\eta)}} \text{; } \mu &gt; 0\]</span></li>
</ul></li>
<li><span class="math inline">\(\eta\)</span> is a <strong>location parameter</strong> and <span class="math inline">\(\mu\)</span> is a <strong>positive scale parameter</strong></li>
<li>Location parameter is <strong>mode</strong> of distribution</li>
<li>Scale parameter defines the <strong>dispersion</strong> of the PDF shape</li>
</ul>
</section>
<section id="type-i-extreme-value-distribution-1" class="slide level2">
<h2>Type I Extreme Value Distribution</h2>

<img data-src="../../../assets/images/teaching/ENCI707/Lecture5/type1distribution.svg" class="quarto-figure quarto-figure-center r-stretch"></section>
<section id="basic-properties-of-gumbel-distribution" class="slide level2 smaller">
<h2>Basic Properties of Gumbel distribution</h2>
<ol type="1">
<li>The <strong>mode</strong> of the distribution is <span class="math inline">\(\eta\)</span> (the location of peak of the PDF on x axis from zero).</li>
<li>The <strong>mean</strong> is (<span class="math inline">\(\eta+\gamma/\mu\)</span>), where <span class="math inline">\(\gamma\)</span> = Eulerâ€™s constant=0.577.</li>
<li>The <strong>variance</strong> is <span class="math inline">\(\pi^2/6\mu^2\)</span>.</li>
<li>If <span class="math inline">\(\epsilon\)</span> is Gumbel distributed with (<span class="math inline">\(\eta, \mu\)</span>), and if <span class="math inline">\(\alpha\)</span> is any positive scalar constant, then (<span class="math inline">\(\alpha \epsilon + V\)</span>) is also Gumbel distributed with parameters (<span class="math inline">\(\alpha \eta +V\)</span>) and <span class="math inline">\(\mu/\alpha\)</span>.</li>
<li>If <span class="math inline">\(\epsilon_1\)</span> and <span class="math inline">\(\epsilon_2\)</span> are independent Gumbel variables, then (<span class="math inline">\(\epsilon_1-\epsilon_2\)</span>) is <strong>logistically distributed</strong>.</li>
<li>If <span class="math inline">\(\epsilon_1\)</span> and are <strong>Identical and Independent Gumbel variables</strong> with parameters (<span class="math inline">\(\eta_1,\mu\)</span>) and (<span class="math inline">\(\eta_2,\mu\)</span>) respectively then <span class="math inline">\(\max(\epsilon_1,\epsilon_2)\)</span> is also Gumbel distributed with parameters:<br>
<span class="math display">\[\left(\frac{1}{\mu} \lnâ¡(ğ‘’^{\mu\eta_1}+ğ‘’^{\mu\eta_2 } ),\mu \right)\]</span></li>
</ol>
</section>
<section id="basic-properties-of-gumbel-distribution-1" class="slide level2 smaller">
<h2>Basic Properties of Gumbel distribution</h2>
<ol start="7" type="1">
<li>If <span class="math inline">\(( \epsilon_1,\epsilon_2,\epsilon_3,\dots ,\epsilon_n )\)</span> are <span class="math inline">\(n\)</span> independent Gumbel distributed variables with parameters (<span class="math inline">\(\eta_1,\mu), (\eta_2,\mu),\dots (\eta_n,\mu)\)</span> respectively then <span class="math inline">\(\max(\epsilon_1,\epsilon_2,\epsilon_3,\dots,\epsilon_n)\)</span> is also Gumbel distributed with parameters (mean, scale): <span class="math display">\[\left(\frac{1}{\mu} \lnâ¡\sum_{ğ‘—=1}^ğ‘› ğ‘’^{\mu \eta_ğ‘—}, \mu \right)\]</span></li>
</ol>
<p><strong>Notes:</strong></p>
<ul>
<li><strong>Homoskedasticity:</strong> Independent Gumbel distributed variables have a common scale parameter, <span class="math inline">\(\mu\)</span>.</li>
<li>Property 5 is used to derive binomial logit model probability equation.</li>
<li>Property 7 can be used to derived closed form equation for multinomial logit (MNL) Model.</li>
</ul>
</section></section>
<section>
<section id="multinomial-logit-model---scale-systematic-utility-functions" class="title-slide slide level1 center">
<h1>Multinomial Logit Model - Scale &amp; Systematic Utility Functions</h1>

</section>
<section id="multinomial-logit-model-mnl" class="slide level2 smaller">
<h2>Multinomial Logit Model (MNL)</h2>
<ul>
<li>In case of a multinomial choice situation: Assume random utility (<span class="math inline">\(\epsilon\)</span>) is Gumbel distributed with <span class="math inline">\(\eta = 0\)</span> location parameter and a common scale, <span class="math inline">\(\mu\)</span>.</li>
<li>Assume that the utility of the second-best alternative is <span class="math inline">\(U^*\)</span>, which is the <strong>maximum of all other alternatives except alternative <span class="math inline">\(j\)</span></strong>, the best one. <span class="math display">\[ğ‘ˆ^âˆ—=\max_{k \neq j \text{ &amp; } ğ‘—,ğ‘˜ \in ğ¶_ğ‘–} (ğ‘‰_ğ‘˜+\epsilon_ğ‘˜ )\]</span></li>
<li>According to Property 7, <span class="math inline">\(U^*\)</span> is also Gumbel distributed with parameters (mean, scale)</li>
</ul>
<p><span class="math display">\[ \left( \frac{1}{\mu} \ln \sum_{k \neq j \text{ &amp; } ğ‘—,ğ‘˜ \in ğ¶_ğ‘–} e^{\mu V_k}, \mu \right)\]</span></p>
</section>
<section id="multinomial-logit-model-mnl-1" class="slide level2 smaller">
<h2>Multinomial Logit Model (MNL)</h2>
<p>We can write that the second-best alternative is <span class="math display">\[U^âˆ—= V^âˆ—+\epsilon^âˆ— \text{, } V^* = \frac{1}{\mu} \ln \sum_{k \neq j \text{ &amp; } ğ‘—,ğ‘˜ \in ğ¶_ğ‘–} e^{\mu V_k}\]</span><br>
Now for the probability of choosing alternative <span class="math inline">\(j\)</span> (equivalent binary logit form) <span class="math display">\[Prâ¡(ğ‘—)=Prâ¡\left((ğ‘‰_ğ‘—+\epsilon_ğ‘—) \ge \max_{k \neq j \text{ &amp; } ğ‘—,ğ‘˜ \in ğ¶_ğ‘–} (V_k + \epsilon_k)\right)\]</span> <span class="math display">\[Prâ¡(ğ‘—)=Pr\left((ğ‘‰_ğ‘—+\epsilon_ğ‘—) \ge (ğ‘‰^âˆ—+\epsilon^âˆ—)\right)\]</span> <span class="math display">\[Prâ¡(ğ‘—)=Prâ¡\left((ğ‘‰^âˆ—+\epsilon^âˆ—)âˆ’(ğ‘‰_ğ‘—+\epsilon_ğ‘—) \leq 0\right)=Pr\left((\epsilon^âˆ—âˆ’\epsilon_ğ‘—) \leq(ğ‘‰_ğ‘—âˆ’ğ‘‰^âˆ—)\right)\]</span></p>
</section>
<section id="multinomial-logit-model-mnl-2" class="slide level2 smaller">
<h2>Multinomial Logit Model (MNL)</h2>
<ul>
<li>According to Property 5, this function is logistically distributed. So</li>
</ul>
<p><span class="math display">\[Prâ¡( ğ‘—)=\frac{1}{1+ğ‘’^{\mu(ğ‘‰^âˆ—âˆ’ğ‘‰_ğ‘—)}} = \frac{e^{\mu V_j}}{e^{\mu V_j}+ğ‘’^{\mu(ğ‘‰^âˆ—âˆ’ğ‘‰_ğ‘—)}}\]</span> <span class="math display">\[Prâ¡( ğ‘—)=\frac{e^{\mu V_j}}{e^{\mu V_j}+e^{\ln \sum_{k \neq j \text{ &amp; } ğ‘—,ğ‘˜ \in ğ¶_ğ‘–} e^{\mu V_k}}}= \frac{e^{\mu V_j}}{e^{\mu V_j}+\sum_{k \neq j \text{ &amp; } ğ‘—,ğ‘˜ \in ğ¶_ğ‘–} e^{\mu V_k}}\]</span> <span class="math display">\[Prâ¡(ğ‘—)=\frac{e^{\mu V_j}}{\sum_{ğ‘˜ \in ğ¶_ğ‘–} e^{\mu V_k}}\]</span></p>
<ul>
<li>This is well-known Multinomial Logit Model (MNL) - or softmax function in ML!</li>
</ul>
</section>
<section id="scale-of-the-mnl-model" class="slide level2 smaller">
<h2>Scale of the MNL Model</h2>
<ul>
<li>Scale (<span class="math inline">\(\mu\)</span>) is inversely related to the variance of random error term</li>
<li>Variance is <span class="math inline">\(\pi^2/6\mu^2\)</span> for a IID Type I EV error</li>
<li>As <span class="math inline">\(\mu -&gt; \infty\)</span>, Variance <span class="math inline">\(-&gt; 0\)</span>
<ul>
<li>All information are captured by the deterministic component (<span class="math inline">\(V\)</span></li>
<li>Choice becomes deterministic (the alternative with maximum V is chosen)</li>
</ul></li>
<li>As <span class="math inline">\(\mu -&gt; 0\)</span>, Variance <span class="math inline">\(-&gt; \infty\)</span> &amp; <span class="math inline">\(\exp(\mu V) = 1\)</span>
<ul>
<li>Alternatives are <strong>equally likely</strong></li>
<li>Choice model does not provide any information</li>
</ul></li>
<li>Constant scale, <span class="math inline">\(\mu\)</span>, is <strong>not identified</strong> in an MNL using only one dataset</li>
<li>Separate scale needs to be specified when fusing multiple datasets</li>
</ul>
</section>
<section id="systematic-utility-function" class="slide level2 smaller">
<h2>Systematic Utility Function</h2>
<p>Systematic utility function: Linear-in-parameter function <span class="math display">\[ğ‘‰_1=\beta_1+\beta_ğ‘¡ ğ‘¥_{1ğ‘¡}+\beta_{1ğ‘} ğ‘¥_ğ‘+\beta_ğ‘ ğ‘¥_{1ğ‘}^2+\beta_{1ğ‘ğ‘} ğ‘¥_ğ‘^3+\beta_{1ğ‘ğ‘™}  \lnâ¡(ğ‘¥_ğ‘)+\dots\]</span> <span class="math display">\[ğ‘‰_2=\beta_2+\beta_ğ‘¡ ğ‘¥_{2ğ‘¡}+\beta_{2ğ‘} ğ‘¥_ğ‘+\beta_ğ‘ ğ‘¥_{2ğ‘}^2+\beta_{2ğ‘ğ‘} ğ‘¥_ğ‘^3+\beta_{2ğ‘ğ‘™} + \lnâ¡(x_a)+\dots\]</span> <span class="math display">\[\vdots\]</span> <span class="math display">\[ğ‘‰_J=\beta_J+\beta_ğ‘¡ ğ‘¥_{Jt}+\beta_{Jğ‘} ğ‘¥_ğ‘+\beta_ğ‘ ğ‘¥_{Jğ‘}^2+\beta_{Jğ‘ğ‘} ğ‘¥_ğ‘^3+\beta_{Jğ‘ğ‘™} + \lnâ¡(x_a)+\dots\]</span></p>
<ul>
<li>Alternative Specific Constant - (J-1) are identified</li>
<li>Permits <strong>non-linear transformed</strong> variables</li>
<li>Can be <strong>generic</strong> if vary across alternatives</li>
<li>Must be <strong>alternative-specific</strong> if constant across alternatives (only J-1 are identified)</li>
</ul>
</section>
<section id="systematic-utility-function-1" class="slide level2 smaller">
<h2>Systematic Utility Function</h2>
<ul>
<li>Systematic utility function: Linear-in-parameter function <span class="math display">\[ğ‘‰_ğ‘—=\beta_ğ‘—+\beta_ğ‘¡ ğ‘¥_{ğ‘—ğ‘¡}+\beta_ğ‘˜ ğ‘¥_{ğ‘—ğ‘˜}+\dots \text{ (individual variable space)}\]</span> <span class="math display">\[ğ‘‰_ğ‘—=\beta_ğ‘—+(\beta_ğ‘¡/\beta_ğ‘˜)ğ‘¥_{ğ‘—ğ‘¡}+ğ‘¥_{ğ‘—ğ‘˜}+\dots
\text{ (variable ratio space)}\]</span> <span class="math display">\[
ğ‘‰_ğ‘—=\beta_ğ‘—+(\beta_ğ‘¡/\beta_ğ‘)ğ‘¥_{ğ‘—âˆ’ğ‘¡ğ‘–ğ‘šğ‘’}+(\beta_ğ‘Ÿ/\beta_ğ‘)ğ‘¥_{ğ‘—âˆ’ğ‘Ÿğ‘’ğ‘™ğ‘–ğ‘ğ‘ğ‘–ğ‘™ğ‘–ğ‘¡ğ‘¦}+ğ‘¥_{ğ‘—âˆ’ğ¶ğ‘œğ‘ ğ‘¡}+\dots
\]</span> <span class="math display">\[ğ‘‰_ğ‘—=\beta_ğ‘—^{'}+\underset{\begin{array}{c} \text{(Willingness-to-pay} \\ \text{for time savings)} \end{array}}{\beta_{ğ‘¡ğ‘}}  ğ‘¥_{ğ‘—âˆ’ğ‘¡ğ‘–ğ‘šğ‘’}+\underset{\begin{array}{c} \text{(Willingness-to-pay} \\ \text{for improved reliability)} \end{array}}{\beta_{ğ‘Ÿğ‘}}  ğ‘¥_{ğ‘—âˆ’ğ‘Ÿğ‘’ğ‘™ğ‘–ğ‘ğ‘ğ‘–ğ‘™ğ‘–ğ‘¡ğ‘¦}+ğ‘¥_{ğ‘—âˆ’ğ¶ğ‘œğ‘ ğ‘¡}+\dots
\]</span></li>
</ul>
</section></section>
<section>
<section id="mnl-estimation-mnl-specification" class="title-slide slide level1 center">
<h1>MNL Estimation &amp; MNL Specification</h1>

</section>
<section id="estimation-of-mnl" class="slide level2 smaller">
<h2>Estimation of MNL</h2>
<ul>
<li>Maximum likelihood estimation: <span class="math display">\[\text{Likelihood function: } ğ¿_ğ‘–=\prod_{ğ‘—=1}^ğ½ (Prâ¡( ğ‘—))^{ğ‘¦_ğ‘–}
\]</span> <span class="math display">\[\text{Log-likelihood function: } LL_ğ‘–=\sum_{ğ‘— \in C_i} y_j \ln(Prâ¡( ğ‘—))
\]</span> <span class="math display">\[\text{Sample log-likelihood function: } LL=\sum_{i=1}^N \sum_{ğ‘— \in C_i} y_j \ln(Prâ¡( ğ‘—))
\]</span></li>
<li>Use <strong>gradient search algorithms</strong></li>
<li>Analytical gradient and Hessian functions provide <strong>faster</strong> estimation than numerical gradient and Hessian functions</li>
</ul>
</section>
<section id="goodness-of-fit" class="slide level2 smaller">
<h2>Goodness-of-Fit</h2>
<p>Model goodness-of-fit is measured by <span class="math inline">\(\rho^2\)</span> value</p>
<p><img data-src="../../../assets/images/teaching/ENCI707/Lecture5/gof_LL.svg" class="absolute" style="top: 150px; left: 0px; "> <br><br><br><br><br> - <span class="math inline">\(k\)</span> = difference in total number of parameters between two models <span class="math display">\[\rho_0^2 = \frac{LL(\beta) - LL(0)}{LL(*) - LL(0)} = 1 - \frac{LL(\beta)}{LL(0)} \text{; } adj-\rho_0^2 = 1 - \frac{LL(\beta) - k}{LL(0)}\]</span></p>
<p><span class="math display">\[\rho_C^2 = \frac{LL(\beta) - LL(C)}{LL(*) - LL(C)} = 1 - \frac{LL(\beta)}{LL(C)} \text{; } adj-\rho_C^2 = 1 - \frac{LL(\beta) - k}{LL(C)}\]</span></p>
<ul>
<li>Adjusted <span class="math inline">\(\rho^2\)</span> value 0.3 to 0.5 is considered reasonable (<em>but depends on model</em>)</li>
<li><strong>Alternative:</strong> Comparing predicted vs.&nbsp;observed shares</li>
</ul>
</section>
<section id="goodness-of-fit-1" class="slide level2 smaller">
<h2>Goodness-of-Fit</h2>
<ul>
<li>Comparing predicted versus observed share of alternatives:
<ul>
<li>Use <strong>holdout sample</strong> (20%-30% sample unused for estimation):
<ul>
<li>Problematic for small sample size</li>
<li>Holding out may distort market sample share of the alternatives and thereby the alternative specific constants</li>
</ul></li>
<li>Use bootstrap:
<ul>
<li>Generate large number of samples bootstrapped from the same sample</li>
<li>Compare under/over predictions</li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="validation-by-bootstrapping" class="slide level2">
<h2>Validation by Bootstrapping</h2>

<img data-src="../../../assets/images/teaching/ENCI707/Lecture5/bootstrap.svg" class="quarto-figure quarto-figure-center r-stretch"></section>
<section id="validation-by-bootstrapping-1" class="slide level2 smaller">
<h2>Validation by Bootstrapping</h2>
<p>Validation by 1000 Bootstrap Sample Simulation</p>
<table class="caption-top">
<colgroup>
<col style="width: 15%">
<col style="width: 17%">
<col style="width: 23%">
<col style="width: 21%">
<col style="width: 22%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Mode</th>
<th style="text-align: center;">Sample Share (%)</th>
<th style="text-align: center;">Mean Prediction Error (%)</th>
<th style="text-align: center;">Max Over-Prediction (%)</th>
<th style="text-align: center;">Max Under-Prediction (%)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Car Driver</td>
<td style="text-align: center;">26</td>
<td style="text-align: center;">0.033</td>
<td style="text-align: center;">3.26</td>
<td style="text-align: center;">-2.78</td>
</tr>
<tr class="even">
<td style="text-align: center;">Car Passenger</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.015</td>
<td style="text-align: center;">0.91</td>
<td style="text-align: center;">-0.71</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Transit</td>
<td style="text-align: center;">59</td>
<td style="text-align: center;">-0.026</td>
<td style="text-align: center;">4.05</td>
<td style="text-align: center;">-3.36</td>
</tr>
<tr class="even">
<td style="text-align: center;">Bicycle</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">0.001</td>
<td style="text-align: center;">2.35</td>
<td style="text-align: center;">-1.72</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Walk</td>
<td style="text-align: center;">11</td>
<td style="text-align: center;">-0.022</td>
<td style="text-align: center;">2.25</td>
<td style="text-align: center;">-2.43</td>
</tr>
</tbody>
</table>
</section>
<section id="specification-tests" class="slide level2">
<h2>Specification Tests</h2>
<ul>
<li>Expected signs of the coefficients</li>
<li>Expected substitution patterns - e.g., value of time savings, etc.</li>
<li>Likelihood ratio test (<span class="math inline">\(\times\)</span>-2 by Wilks Theorem):<span class="math inline">\(-2[LL(\beta)-LL(\beta^{'})]\)</span> is <span class="math inline">\(\chi^2\)</span> distributed with <span class="math inline">\(k\)</span> (= number of restricted parameters = the difference between number of parameters of two models) degrees of freedom</li>
<li>Goodness-of-Fit measures: Rho-square, AIC, BIC</li>
</ul>
</section>
<section id="specification-of-logit-model" class="slide level2 smaller">
<h2>Specification of Logit Model</h2>
<ul>
<li>Logit model works fine if there is no significant random variation of effects of any systematic variables:
<ul>
<li><strong>Unobserved (random) effects</strong> of any variable (varying across the alternatives and/or observations) violates the identical error term distribution assumption!</li>
</ul></li>
<li>Example:
<ul>
<li>Effects of driving cost is influenced by income only: systematic effect and logit model will work fine with <strong>cost normalized by income</strong></li>
<li>Effects of driving cost influenced by income and some unobserved factor: the logit model will be <strong>mis-specified</strong></li>
</ul></li>
</ul>
</section>
<section id="specification-of-logit-model-1" class="slide level2">
<h2>Specification of Logit Model</h2>
<ul>
<li>Logit model works fine if choice alternatives are perfectly IIA (independent of irrelevant alternatives): proportional substitution exists
<ul>
<li><strong>Imperfect competition</strong> or <strong>correlated variations</strong> among subsets of alternatives cause the violation of identical error term distribution assumption!</li>
</ul></li>
<li>Example:
<ul>
<li>People who prefer private car, will prefer taxi <strong>more</strong> than they prefer transit - logit model that considers all alternative modes are IIA will be <strong>mis-specified</strong></li>
</ul></li>
</ul>
</section>
<section id="collinearity-of-independent-variables" class="slide level2 smaller">
<h2>Collinearity of Independent Variables</h2>
<ul>
<li>If some variables in the model are <strong>collinear</strong> then the corresponding parameters can change arbitrarily
<ul>
<li>Unstable parameter estimation</li>
<li>Hessian matrix may not be definite</li>
</ul></li>
<li>It is possible to have correlated variables in the discrete choice model unless they are <strong>highly collinear</strong>
<ul>
<li>For high collinearity, a <strong>small change</strong> in model or data causes drastic changes in parameter estimates</li>
</ul></li>
<li>Example: <span class="math inline">\(V=\beta_t(Time)+ \beta_c(Cost)\)</span>, if <span class="math inline">\(Cost= \beta_b+ \beta_d(Time)\)</span>, then <span class="math inline">\(V= (\beta_t + \beta_t\beta_d)Time+ \beta_c \beta_b\)</span>
<ul>
<li><strong>Identification issue</strong></li>
</ul></li>
<li><strong>Solution:</strong> Create <strong>composite variable</strong> using the correlated variables (e.g., cost/time)</li>
</ul>
</section>
<section id="incomebudget-effects" class="slide level2 smaller">
<h2>Income/Budget Effects</h2>

<img data-src="../../../assets/images/teaching/ENCI707/Lecture5/income_budget_effect.svg" class="quarto-figure quarto-figure-center r-stretch"><ul>
<li>Testing income effects:
<ul>
<li>Use <span class="math inline">\(Cost\)</span> and <span class="math inline">\(Cost^2\)</span> as separate variables</li>
<li>If <span class="math inline">\(Cost^2\)</span> has a statistically significant and reasonable parameter value, income effects need to be addressed</li>
</ul></li>
<li>Addressing income effects:
<ul>
<li>Income normalization as (<span class="math inline">\(Cost/Income\)</span>) or (<span class="math inline">\(Income-Cost\)</span>)</li>
<li>Classifying population into different income categories and develop separate models for each</li>
<li>Interact income category with other variables</li>
</ul></li>
</ul>
</section>
<section id="aggregationmarket-segmentation" class="slide level2">
<h2>Aggregation/Market Segmentation</h2>

<img data-src="../../../assets/images/teaching/ENCI707/Lecture5/aggregation.svg" class="quarto-figure quarto-figure-center r-stretch"></section>
<section id="aggregationmarket-segmentation-1" class="slide level2">
<h2>Aggregation/Market Segmentation</h2>

<img data-src="../../../assets/images/teaching/ENCI707/Lecture5/market_segmentation.svg" class="quarto-figure quarto-figure-center r-stretch"><ul>
<li>Here 60% of vehicle owners are higher income people
<ul>
<li>60% of low-income vehicle owners are in white-collar group</li>
</ul></li>
<li>So, we should be careful in categorization at the stage of parameter estimation</li>
</ul>
</section>
<section id="aggregationmarket-segmentation-2" class="slide level2">
<h2>Aggregation/Market Segmentation</h2>
<ul>
<li><strong>Multicollinearity</strong> &amp; <strong>correlation</strong> among independent (explanatory) variables may affect model predictions</li>
<li>Appropriate <strong>clustering method</strong> can be used to derive finite and exhaustive sets of market segments to develop separate models</li>
<li>Separate model for each market segment can sometimes help <strong>capture heterogeneity</strong> in complicated markets</li>
</ul>
</section>
<section id="aside-correlation-collinearity-multicollinearity" class="slide level2">
<h2>Aside: Correlation, Collinearity, &amp; Multicollinearity</h2>
<ul>
<li><strong>Correlation:</strong> when an <strong>independent variable</strong> exhibits a strong <strong>linear</strong> relationship with the <strong>dependent variable</strong></li>
<li><strong>Collinearity:</strong> when two (or more) <strong>independent variables</strong> exhibit a strong <strong>linear</strong> relationship - may exist between multiple variables</li>
<li><strong>Multicollinearity:</strong> Specific case of collinearity between <strong>more than two variables</strong></li>
<li>Collinearity can occur <strong>without linear relationship</strong> between any two variables</li>
</ul>
</section></section>
<section>
<section id="elasticity-marginal-effect-substitution-in-mnl" class="title-slide slide level1 center">
<h1>Elasticity, Marginal Effect, &amp; Substitution in MNL</h1>

</section>
<section id="marginal-effectelasticity-attributes-of-alternatives" class="slide level2 smaller">
<h2>Marginal Effect/Elasticity: Attributes of Alternatives</h2>
<ul>
<li><strong>Disaggregate Direct elasticity/marginal effect:</strong> with respect to an attribute of the <strong>same alternative</strong> <span class="math display">\[\text{Direct ME} =\frac{\partial Prâ¡(ğ‘—)}{\partial ğ‘¥_j}=Prâ¡(ğ‘—)(1âˆ’Prâ¡( ğ‘—)) \beta_{ğ‘¥_ğ‘—}\]</span> <span class="math display">\[\text{Direct E}=  \frac{\partial Prâ¡(ğ‘—)}{\partial ğ‘¥_j}\frac{x_j}{Pr(j)}=x_j(1âˆ’Prâ¡( ğ‘—)) \beta_{ğ‘¥_ğ‘—}\]</span></li>
</ul>
</section>
<section id="marginal-effectelasticity-attributes-of-alternatives-1" class="slide level2 smaller">
<h2>Marginal Effect/Elasticity: Attributes of Alternatives</h2>
<ul>
<li><p><strong>Disaggregate Cross elasticity/marginal effect:</strong> with respect to an attribute of <strong>different alternative</strong> <span class="math display">\[\text{Cross ME} =\frac{\partial Prâ¡(ğ‘—)}{\partial ğ‘¥_k}=Prâ¡(ğ‘—)Prâ¡(k) \beta_{ğ‘¥_k}\]</span> <span class="math display">\[\text{Cross E}=  \frac{\partial Prâ¡(ğ‘—)}{\partial ğ‘¥_k}\frac{x_k}{Pr(j)}=-x_kPrâ¡(k) \beta_{ğ‘¥_k}\]</span></p></li>
<li><p>Cross elasticity is the same for all other alternative than alternative <span class="math inline">\(k\)</span></p></li>
<li><p>This is <strong>proportional substitution</strong>: an improvement in one alternative, draws proportionately from all other alternatives!</p></li>
</ul>
</section>
<section id="fact-to-check-attributes-of-alternatives" class="slide level2 smaller">
<h2>Fact to check: Attributes of Alternatives</h2>
<ul>
<li>Summation of all probabilities of a choice model = 1
<ul>
<li>Summation of changes in probabilities (of all alternatives) with respect to a variable (derivative) = 0 <span class="math display">\[\sum_j \frac{\partial Pr(j)}{\partial x_{jp}}=\frac{\partial Pr(j)}{\partial x_{jp}} + \sum_{k \neq j} \frac{\partial Pr(k)}{\partial x_{jp}} \text{; (Considering generic coefficients)}\]</span> <span class="math display">\[\sum_j \frac{\partial Pr(j)}{\partial x_{jp}}=\beta_p Pr(j) (1-Pr(j)) - \beta_p Pr(j)\sum_{k \neq j}Pr(k)\]</span> <span class="math display">\[\sum_j \frac{\partial Pr(j)}{\partial x_{jp}}=\beta_p Pr(j) (1-Pr(j)) - \beta_p Pr(j) (1-Pr(j)) = 0\]</span></li>
</ul></li>
<li>This is true for <strong>any discrete choice model</strong> and can be used to verify accuracy of elasticity calculation</li>
</ul>
</section>
<section id="aggregating-elasticity-attributes-of-alternatives" class="slide level2" style="font-size: 0.65em;">
<h2>Aggregating Elasticity: Attributes of Alternatives</h2>
<ul>
<li>Disaggregate discrete choice model gives disaggregate values of elasticity for each data point in the sample</li>
<li>Approaches to meaningfully aggregate:
<ul>
<li>NaÃ¯ve approach: Consider sample average values of explanatory variables (x) to calculate sample average elasticity</li>
<li>Estimate elasticity for each sample respondent and draw distribution of elasticity values</li>
<li>Probability weighted sample enumeration (PWSE):</li>
</ul></li>
</ul>
<div class="columns">
<div class="column" style="width:50%;">
<p><span class="math display">\[ğ¸_{ğ‘¥_ğ‘˜}^ğ‘—=\sum_{i=1}^n \frac{Pr_i(j)}{\sum_{i=1}^n Pr_i(j)}E_{x_k}^{Pr_i(j)}\]</span></p>
</div><div class="column" style="width:50%;">
<ul>
<li><span class="math inline">\(i\)</span> is the individual in the sample of size n</li>
<li><span class="math inline">\(j\)</span> is the specific alternative</li>
<li><span class="math inline">\(x\)</span> is the variable of elasticity</li>
<li><span class="math inline">\(j=k\)</span> indicates direct elasticity</li>
<li><span class="math inline">\(j \neq k\)</span> indicates cross-elasticity</li>
</ul>
</div></div>
<ul>
<li>Same approach is application for marginal effect and for any choice model</li>
</ul>
</section>
<section id="section" class="slide level2">
<h2></h2>

<img data-src="../../../assets/images/teaching/ENCI707/Lecture5/figure8.1.png" class="quarto-figure quarto-figure-center r-stretch"></section>
<section id="marginalelasticity-attributes-of-choice-makerchoice-context" class="slide level2" style="font-size: 0.65em;">
<h2>Marginal/Elasticity: Attributes of Choice Maker/Choice Context</h2>
<ul>
<li>Such attributes have <strong>alternative-specific coefficients</strong>: For example, consider income of choice maker <span class="math display">\[\frac{\partial Pr(j)}{\partial Inc_{ij}} = (1-Pr(j))Pr(j)\beta_{inc,ij} \text{; }j,k\in C_i\]</span> <span class="math display">\[\frac{\partial Pr(j)}{\partial Inc_{ik}} = Pr(j)Pr(k)\beta_{inc,ik}\]</span></li>
<li>Corresponding sum of all alternatives, <span class="math inline">\(j \neq k\)</span> <span class="math display">\[\sum_{j \neq k} \frac{\partial Pr(j)}{\partial Inc_{ik}} = -Pr(j) \sum_{k \neq j} Pr(k) \beta_{inc,ik}\]</span></li>
<li>Rate of change of <span class="math inline">\(Pr(j)\)</span> with respect to income of individual, i: <span class="math display">\[\frac{\partial Pr(j)}{\partial Inc_i} = \underset{\text{Direct Elasticity}}{\frac{\partial Pr(j)}{\partial Inc_{ij}}} + \underset{\text{Cross Elasticity}}{\sum_{j \neq k}\frac{\partial Pr(j)}{\partial Inc_{ij}}}\]</span></li>
</ul>
</section>
<section id="marginalelasticity-attributes-of-choice-makerchoice-context-1" class="slide level2 smaller">
<h2>Marginal/Elasticity: Attributes of Choice Maker/Choice Context</h2>
<ul>
<li>Rate of change of <span class="math inline">\(Pr(j)\)</span> with respect to income: <span class="math display">\[\frac{\partial Pr(j)}{\partial Inc_i} = \frac{\partial Pr(j)}{\partial Inc_{ij}} + \sum_{k \neq j} \frac{\partial Pr(j)}{\partial Inc_{ik}} = (1-Pr(j))Pr(j)\beta_{inc,ij}-Pr(j)\sum_{k \neq j} Pr(k) \beta_{inc,ik}\]</span> <span class="math display">\[\frac{\partial Pr(j)}{\partial Inc_i} = Pr(j)\beta_{inc,ij}-Pr(j)Pr(j)\beta_{inc,ij}-Pr(j)\sum_{k \neq j}Pr(k)\beta_{inc,ik}\]</span> <span class="math display">\[\frac{\partial Pr(j)}{\partial Inc_i} = Pr(j)\left( \beta_{inc,ij} - \overline{\beta_{inc}} \right)\]</span> <span class="math display">\[\overline{\beta_{inc,i}} = \sum_{k \in C_i} Pr(k)\beta_{inc,k} \begin{array}{c}\text{; probability weighted average of}\\ \text{alt specific income parameters}\end{array}\]</span></li>
</ul>
</section>
<section id="marginalelasticity-attributes-of-choice-makerchoice-context-2" class="slide level2 smaller">
<h2>Marginal/Elasticity: Attributes of Choice Maker/Choice Context</h2>
<ul>
<li>Elasticity <span class="math inline">\(Pr(j)\)</span> with respect to income: <span class="math display">\[\frac{\partial Pr(j)}{\partial Inc}\frac{Inc}{Pr(j)} = Inc(\beta_{inc,j} - \overline{\beta_{inc}})\]</span> <span class="math display">\[\overline{\beta_{inc}} = \sum_{k \in C_i} Pr(k)\beta_{inc,k}\]</span></li>
<li>Elastictiy <span class="math inline">\(Pr(j)\)</span> with respect to age: <span class="math display">\[\frac{\partial Pr(j)}{\partial Age}\frac{Age}{Pr(j)} = Age(\beta_{age,j} - \overline{\beta_{age}})\]</span> <span class="math display">\[\overline{\beta_{age}} = \sum_{k \in C_i} Pr(k)\beta_{age,k}\]</span></li>
</ul>
</section>
<section id="aggregating-elasticity-attributes-of-choice-makerchoice-context" class="slide level2">
<h2>Aggregating Elasticity: Attributes of Choice Maker/Choice Context</h2>
<ul>
<li>Use similar approach of aggregating market share from disaggregate choice model predictions (discussed in detail later):
<ol type="1">
<li>Microsimulation</li>
<li>Sample enumeration</li>
<li>Classification with naÃ¯ve aggregation</li>
<li>NaÃ¯ve aggregation</li>
</ol></li>
<li>Same approach is application for marginal effect and for any choice model</li>
</ul>
</section>
<section id="marginalelasticity-of-categorical-variables" class="slide level2 smaller">
<h2>Marginal/Elasticity of Categorical Variables</h2>
<ul>
<li>Choice elasticity with respect to a categorical variable is <strong>tricky</strong>
<ul>
<li>â€œ1% change in choice probability with respect to 1% change in a categorical variableâ€ - e.g., presence/absence of parking spot at destination has little meaning!</li>
</ul></li>
<li><strong>Arc-elasticity</strong> is the best way: Express the change in choice probability for the presence/absence of the categorical variable - i.e., <em>ceteris paribus</em> <span class="math display">\[E_{x_i}^{ji} = \frac{Pr(j)_{x_i=1} - Pr(j)_{x_i=0}}{(x_i=1) - (x_i=0)}\frac{((x_i=1)+(x_i=0))/2}{((Pr(j)_{x_i=1})+(Pr(j)_{x_i=0}))/2}\]</span> <span class="math display">\[E_{x_i}^{ji} = \frac{Pr(j)_{x_i=1} - Pr(j)_{x_i=0}}{Pr(j)_{x_i=1}+Pr(j)_{x_i=0}}\]</span></li>
<li>Arc-elasticity can also be used for continuous variables</li>
</ul>
</section>
<section id="proportional-substitution" class="slide level2 smaller">
<h2>Proportional Substitution</h2>
<ul>
<li><strong>Proportional substitution:</strong> an improvement in one alternative, draws proportionately from all other alternatives!</li>
</ul>

<img data-src="../../../assets/images/teaching/ENCI707/Lecture5/proportional_substitution.svg" class="quarto-figure quarto-figure-center r-stretch"></section>
<section id="iia-independent-and-irrelevant-alternatives" class="slide level2 smaller">
<h2>IIA: Independent and Irrelevant Alternatives</h2>
<p><span class="math display">\[\frac{Pr(j)}{Pr(k)} = \frac{\exp(V_j)}{\exp(V)k)} = \exp(V_j - V_k)\]</span></p>
<ul>
<li>This property is derived from assumption: the random utilities,<span class="math inline">\(\epsilon\)</span> are <strong>independent and identical in distribution</strong></li>
<li>Random error are identically distributed, having <strong>same scale or variance</strong> <span class="math display">\[\begin{equation}
\begin{bmatrix} \epsilon_1 \\
\epsilon_2 \\
\epsilon_3 \end{bmatrix} =
\begin{bmatrix} \sigma^2 &amp; 0 &amp; 0 \\
0 &amp; \sigma^2 &amp; 0 \\
0 &amp; 0 &amp; \sigma^2 \end{bmatrix} =
\frac{\pi^2}{6 \mu^2} \begin{bmatrix} 1 &amp; 0 &amp; 0 \\
0 &amp; 1 &amp; 0 \\
0 &amp; 0 &amp; 1 \end{bmatrix}
\end{equation}\]</span></li>
</ul>
</section>
<section id="iia-independent-and-irrelevant-alternatives-1" class="slide level2 smaller">
<h2>IIA: Independent and Irrelevant Alternatives</h2>
<ul>
<li><strong>Example of blue bus/red bus:</strong> If real alternatives are not following IIA, then MNL would induce serious error
<ul>
<li><strong>Previous:</strong> P(car)=1/2 and P(<span style="color: blue;">blue bus</span>)=1/2</li>
<li>Now a new <span style="color: red;">red bus</span> is introduced and under the IIA assumption that the ratio of choice probabilities between car and <span style="color: blue;">blue bus</span> must be constant, so P(car)=1/3, P(<span style="color: blue;">blue bus</span>)=1/3 and P(<span style="color: red;">red bus</span>)=1/3, which is unrealistic Actual will be P(car)=1/2, P(<span style="color: blue;">blue bus</span>)=1/4 and P(<span style="color: red;">red bus</span>)=1/4; but now the ratio of car and <span style="color: blue;">blue bus</span> is not the same as was before introducing <span style="color: red;">red bus</span></li>
</ul></li>
</ul>
</section>
<section id="iia-independent-and-irrelevant-alternatives-2" class="slide level2" style="font-size: 0.65em;">
<h2>IIA: Independent and Irrelevant Alternatives</h2>
<ul>
<li>Three alternatives with same utilities 1: car, 2: <span style="color: blue;">blue bus</span> and 3: <span style="color: red;">red bus</span> and (V1=V2=V3=V)
<ul>
<li>Now probability of choosing 1: car would be compared against the second highest attractive alternative (<span class="math inline">\(U^*\)</span>) <span class="math display">\[ğ‘ˆ^âˆ—=\maxâ¡( ğ‘ˆ_2,ğ‘ˆ_3)=ğ‘‰^âˆ—+\epsilon^âˆ—
\]</span></li>
</ul></li>
<li>As per Gumbel distribution with 0 mean and unit scale <span class="math display">\[ğ‘‰^âˆ—=\lnâ¡( ğ‘’^{ğ‘‰_2}+ğ‘’^{ğ‘‰_3})=\lnâ¡( 2ğ‘’^ğ‘‰)=\lnâ¡(2)+ğ‘‰
\]</span></li>
<li>This step assumed that the random errors of alternative 2(<span style="color: blue;">blue bus</span>) and 3(<span style="color: red;">red bus</span>) are independent and in such case, probability of choosing car: <span class="math display">\[ğ‘ƒ(ğ‘ğ‘ğ‘Ÿ)=\frac{1}{1+ğ‘’^{ğ‘‰^âˆ—âˆ’ğ‘‰_1}} = \frac{1}{1+ğ‘’^{ğ‘‰+\lnâ¡2âˆ’ğ‘‰}} = \frac{1}{1+2}=1/3
\]</span></li>
</ul>
</section>
<section id="iia-independent-and-irrelevant-alternatives-3" class="slide level2 smaller">
<h2>IIA: Independent and Irrelevant Alternatives</h2>
<ul>
<li>Actually, 2(<span style="color: blue;">blue bus</span>) and 3(<span style="color: red;">red bus</span>) are <strong>perfectly correlated</strong> and in that case the maximum utility of 2 and 3 are simply <span class="math inline">\((V+\epsilon)\)</span> that means <span class="math inline">\(V^*=V\)</span> <span class="math display">\[ğ‘ƒ(ğ‘ğ‘ğ‘Ÿ) = \frac{1}{1+ğ‘’^{ğ‘‰^âˆ—âˆ’ğ‘‰_1}} = \frac{1}{1+ğ‘’^{ğ‘‰âˆ’ğ‘‰}} = \frac{1}{1+1}=1/2
\]</span></li>
<li>That means IID assumption makes <span class="math inline">\(V^*\)</span> <strong>too high</strong> by an amount of <span class="math inline">\(\ln2\)</span></li>
<li>IIA is <strong>attributed to disaggregate/individual choice situations, not the overall market share</strong></li>
</ul>
</section>
<section id="iia-violation-test" class="slide level2 smaller">
<h2>IIA Violation Test</h2>
<ul>
<li>We can always test IIA by developing alternative nested logit models.</li>
<li>It is also possible to test statistically whether IIA is violated or not without developing nested logit models.</li>
</ul>
<p><strong>Steps for testing IIA:</strong></p>
<ol type="1">
<li>Estimate the base MNL model for the <strong>full set of alternatives</strong> and refer to its parameters as <span class="math inline">\(\beta_C\)</span><br>
</li>
<li><strong>Remove</strong> one or more alternatives with suspected IIA violation problem to make the constrained choice set <span class="math inline">\(C^{'}\)</span></li>
<li>This will reduce the number of parameters in the new model and its parameter set is then <span class="math inline">\(\beta_C^{'}\)</span></li>
</ol>
<ul>
<li>In each case, in addition to estimating the parameter sets we also produce <strong>variance covariance matrices</strong>, <span class="math inline">\(\Sigma\)</span>, (Inverse of Hessian Matrix) of the estimated parameters sets</li>
</ul>
</section>
<section id="iia-violation-test-1" class="slide level2 smaller">
<h2>IIA Violation Test</h2>
<ol start="4" type="1">
<li>Let us refer to the corresponding matrices as <span class="math inline">\(\Sigma_{\beta_C}\)</span> and <span class="math inline">\(\Sigma_{\beta_C^{'}}\)</span> of the full model and the restricted model, respectively</li>
<li>If the alternatives in the choice set <strong>satisfy IIA</strong> then the two variance-covariance matrices will have the <strong>same values for corresponding cells</strong>: <span class="math inline">\(\Sigma_{\beta_C} = \Sigma_{\beta_C^{'}}\)</span><br>
</li>
<li>Let us consider the Null Hypothesis, <span class="math inline">\(H_0: \beta_C = \beta_C^{''}\)</span><br>
</li>
<li>Conduct tests:</li>
</ol>
<ul>
<li>Hausman and McFadden Test</li>
<li>Small and Haiso Test</li>
</ul>
</section>
<section id="iia-violation-test-2" class="slide level2 smaller">
<h2>IIA Violation Test</h2>
<p><strong>Hausman and McFadden Test</strong> (Econometrica, 1984): <span class="math display">\[(\hat{\beta}_{C^{'}}âˆ’\hat{\beta}_C)^ğ‘‡(\Sigma_{\hat{\beta_C^{'}}}âˆ’\Sigma_{\hat{\beta}_C})^{âˆ’1}(\hat{\beta}_{C^{'}}-\hat{\beta_C})\]</span> - This is <span class="math inline">\(\chi^2\)</span> distributed with <strong>degrees of freedom equal to the number of alternatives removed in the restricted model</strong></p>
<p><strong>Small and Haiso Test</strong> (International Economic Review, 1985):</p>
<ul>
<li>Conduct likelihood ratio test between base model and the restricted model <span class="math display">\[âˆ’2(ğ¿ğ¿_{\hat{\beta}_ğ¶^{'}}âˆ’ğ¿ğ¿_{\hat{\beta}_ğ¶})\]</span></li>
<li>This likelihood ratio is <span class="math inline">\(\chi^2\)</span> distributed with <strong>degrees of freedom equal to the number of alternatives removed in the restricted model</strong></li>
</ul>
</section></section>
<section>
<section id="policy-evaluation-using-mnl" class="title-slide slide level1 center">
<h1>Policy Evaluation Using MNL</h1>

</section>
<section id="policy-evaluations" class="slide level2 smaller">
<h2>Policy Evaluations</h2>
<ul>
<li>Elasticity:
<ul>
<li>Direct elasticity</li>
<li>Cross elasticity</li>
</ul></li>
<li>Consumer surplus &amp; social welfare analysis</li>
<li>Marginal rate of substitution between two variables (ratio of corresponding parameters) in the choice model:
<ul>
<li>Value of Travel Time Savings (<strong>VOTTS</strong>) in mode choice</li>
<li>Willingness to pay for improved transit reliability in transit choice</li>
<li>Willingness to pay for transit accessibility in home location choice</li>
</ul></li>
</ul>
</section>
<section id="willingness-to-pay-analysis" class="slide level2" style="font-size: 0.65em;">
<h2>Willingness-to-pay Analysis</h2>
<ul>
<li>Systematic utility function needs to have cost as a variable <span class="math inline">\(p\)</span> along with another variable of interest <span class="math inline">\(x\)</span>. <span class="math display">\[V_j = V_j(p_j,x_j, \dots) -&gt; p\text{ is a continuous variable &amp; } V_j \text{ is differentiable in x and p}\]</span></li>
<li><strong>Assumption:</strong> Any changes in <span class="math inline">\(x\)</span> is balanced by changes in <span class="math inline">\(p\)</span> to maintain same level of utility: total utility does not change <span class="math display">\[V_j = V_j(p_j,x_j, \dots) = V_j((p_j+\delta p_j),(x_j + \delta x_j), \dots)\]</span></li>
<li>Using first-order Taylor series expansion <span class="math display">\[V_j(p_j,x_j, \dots) = V_j(p_j,x_j, \dots) + \delta p_j \frac{\partial V_j(p_j,x_j, \dots)}{\partial p_j} + \delta x_j \frac{\partial V_j(p_j,x_j, \dots)}{\partial x_j}\]</span></li>
<li>After transposing (assuming overall utility change is zero) <span class="math display">\[\frac{\delta p_j}{\delta x_j} = - \frac{V_j(p_j, x_j, \dots)/\partial x_j}{V_j(p_j, x_j, \dots)/\partial p_j} \text{; additional price to compensate additional x}\]</span></li>
</ul>
</section>
<section id="willingness-to-pay-analysis-1" class="slide level2 smaller">
<h2>Willingness-to-pay Analysis</h2>
<ul>
<li>For linear-in-parameter utility function <span class="math inline">\(V_j = \beta_j + \beta_p p_j + \beta_x x_j + \dots\)</span></li>
<li>Willing-to-pay for any continuous variable change <span class="math inline">\(\frac{\partial p_j}{\partial x_j} = - \frac{\beta_x}{\beta_p}\)</span></li>
<li>Value of Travel Time Savings (<strong>VOTTS</strong>): additional amount of money to <strong>reduce</strong> 1 unit of time <span class="math display">\[VOTTS = \frac{\partial p_j}{- \partial t_j} = \frac{\beta_t}{\beta_p}\]</span></li>
<li>Value of Reliability (<strong>VOR</strong>) or Safety (<strong>VOS</strong>) : additional amount of money to <strong>increase</strong> 1 level of reliability (r), safety (s) <span class="math display">\[VOR = \frac{\partial p_j}{+ \partial r_j} = - \frac{\beta_r}{\beta_p}\text{; } VOS = - \frac{\partial p_j}{+ \partial s_j} = \frac{\beta_s}{\beta_p}\]</span></li>
</ul>
</section>
<section id="consumer-surplus" class="slide level2 smaller">
<h2>Consumer Surplus</h2>

<img data-src="../../../assets/images/teaching/ENCI707/Lecture5/consumer_surplus.svg" class="quarto-figure quarto-figure-center r-stretch"><p><span class="math display">\[\Delta CS = \int_{V_j^1}^{V_j^2} Pr_i(j|V_j, V_{k \in C_i, k \neq j}) d V_j = \int_{V_j^1}^{V_j^2} \frac{\exp(\mu V_j)}{\sum_{k \in C_i} \exp(\mu V_k)}d V_j\]</span></p>
</section>
<section id="consumer-surplus-1" class="slide level2 smaller">
<h2>Consumer Surplus</h2>
<p>For Changes in only one (independent) alternative (<span class="math inline">\(j\)</span>): <span class="math display">\[\Delta CS = \frac{1}{\mu}\ln\left(\exp(\mu V_j^2) + \sum_{k \in C_i} \exp(\mu V_k)\right) - \frac{1}{\mu}\ln\left(\exp(\mu V_j^1) + \sum_{k \in C_i} \exp(\mu V_k)\right)\]</span> - For changes in <strong>multiple alternatives</strong> (existence of equal or unequal cross-elasticity, e.g., nested logit, GEV, mixed logit) the integral is <strong>path dependent</strong> since it becomes conditional upon an income effect - For logit model <span class="math display">\[\Delta CS = \frac{1}{\mu}\ln\left(\sum_{j \in C_i} \exp(\mu V_j^2)\right) - \frac{1}{\mu}\ln\left(\sum_{j \in C_i} \exp(\mu V_j^1)\right)\]</span></p>
</section>
<section id="welfare-analysis" class="slide level2 smaller">
<h2>Welfare Analysis</h2>
<ul>
<li><strong>Compensating variation analysis:</strong> normalized changes in expected maximum utility of a particular choice before/after any changes (policy/infrastructure): <span class="math display">\[U_j = \beta_I(I-p_j) + \sum \beta x + \epsilon_j\]</span></li>
<li>where <span class="math inline">\(I\)</span> = income, <span class="math inline">\(p_j\)</span> = price/cost, <span class="math inline">\(\beta_I\)</span> = marginal utility of income = coefficient of income normalized cost</li>
<li>Consumer surplus (<strong>CS</strong>): <span class="math display">\[CS = \frac{1}{\mu}\left(\ln \sum_j \exp \left(\mu (\beta_I(I-p_j) + \sum \beta x)\right) \right)\]</span></li>
<li>Compensting variation (<strong>CV</strong>) in monetary value: <span class="math display">\[CV = \frac{1}{|\beta_I|}\left( CS_{after-change} - CS_{before-change} \right)\]</span></li>
</ul>
</section></section>
<section>
<section id="forecasting-prediction-using-disaggregate-choice-models" class="title-slide slide level1 center">
<h1>Forecasting &amp; Prediction Using Disaggregate Choice Models</h1>

</section>
<section id="applying-disaggregate-model-for-forecasting" class="slide level2 smaller">
<h2>Applying Disaggregate Model for Forecasting</h2>
<ul>
<li>Aggregate forecasting <span class="math display">\[\sum_{individuals} \text{Individual Behaviour} = \text{Aggregate(collective) Outcome}\]</span></li>
<li>Can synthesize people with attributes from census data - i.e., 100% microsimulation with <strong>synthetic population</strong></li>
</ul>

<img data-src="../../../assets/images/teaching/ENCI707/Lecture5/aggregation_forecast.svg" class="quarto-figure quarto-figure-center r-stretch"></section>
<section id="applying-disaggregate-choice-model-for-forecasting" class="slide level2 smaller">
<h2>Applying Disaggregate Choice Model for Forecasting</h2>
<ul>
<li>We do aggregate forecasts, so why do we need disaggregate models?
<ul>
<li><strong>Aggregation suppresses information</strong> -&gt; misleading information after data aggregation (i.e., Simpsonâ€™s Paradox &amp; Ecological Fallacy)</li>
<li>Statistical inefficiency of aggregate approach</li>
<li>Although we aggregate the forecast, we can explicitly capture information at individual level</li>
<li>We can track many <strong>sensitive policy issues</strong></li>
<li>Aggregation of forecast is possible at any level we want, as the model is disaggregate</li>
<li>Sometimes modelling at disaggregate level makes the model independent of artificial zonal structures and the model may be transferrable</li>
</ul></li>
</ul>
</section>
<section id="aggregation-methods-for-forecasting" class="slide level2">
<h2>Aggregation Methods for Forecasting</h2>
<ul>
<li>Microsimulation</li>
<li>Sample enumeration</li>
<li>NaÃ¯ve aggregation</li>
<li>Classification with naÃ¯ve aggregation</li>
</ul>
</section>
<section id="microsimulation" class="slide level2 smaller">
<h2>Microsimulation</h2>
<table>
<tbody><tr>
<th>
Synthetic Population
</th>
<th colspan="5" style="text-align:center;">
Choice Alternatives
</th>
</tr>
<tr>
<td>
</td>
<td>
1
</td>
<td>
2
</td>
<td>
â€¦
</td>
<td>
J
</td>
<td>
Sum
</td>
</tr>
<tr>
<td>
1
</td>
<td>
<span class="math inline">\(Pr(1|x_1,\beta)\)</span>
</td>
<td>
<span class="math inline">\(Pr(2|x_1,\beta)\)</span>
</td>
<td>
.
</td>
<td>
<span class="math inline">\(Pr(J|x_1,\beta)\)</span>
</td>
<td>
1
</td>
</tr>
<tr>
<td>
2
</td>
<td>
<span class="math inline">\(Pr(1|x_2,\beta)\)</span>
</td>
<td>
<span class="math inline">\(Pr(2|x_2,\beta)\)</span>
</td>
<td>
.
</td>
<td>
<span class="math inline">\(Pr(J|x_2,\beta)\)</span>
</td>
<td>
1
</td>
</tr>
<tr>
<td>
â€¦
</td>
<td>
.
</td>
<td>
.
</td>
<td>
.
</td>
<td>
.
</td>
<td>
.
</td>
</tr>
<tr>
<td>
N
</td>
<td>
<span class="math inline">\(Pr(1|x_N,\beta)\)</span>
</td>
<td>
<span class="math inline">\(Pr(2|x_N,\beta)\)</span>
</td>
<td>
.
</td>
<td>
<span class="math inline">\(Pr(J|x_N,\beta)\)</span>
</td>
<td>
1
</td>
</tr>
<tr>
<td>
Sum
</td>
<td>
N(1)
</td>
<td>
N(2)
</td>
<td>
</td>
<td>
N(J)
</td>
<td>
N
</td>
</tr>
<tr>
<td>
Market share
</td>
<td>
N(1)/N
</td>
<td>
N(2)/N
</td>
<td>
</td>
<td>
N(J)/N
</td>
<td>
1
</td>
</tr>
</tbody></table>
</section>
<section id="sample-enumeration" class="slide level2" style="font-size: 0.65em;">
<h2>Sample Enumeration</h2>
<ul>
<li>Rather than 100% population, use a representative sample
<ul>
<li>If we have a representative sample, <span class="math inline">\(N_S\)</span>, of the target population <span class="math inline">\(N_T\)</span> then: <span class="math display">\[\overset{\sim}{W_i} = \text{Predicted sample share of j} = \frac{1}{N_S}\sum_{s=1}^{N_S} Pr(j|X_S,\beta)\]</span></li>
</ul></li>
</ul>
<table>
<tbody><tr>
<th>
Representative Sample
</th>
<th colspan="5" style="text-align:center;">
Choice Alternatives
</th>
</tr>
<tr>
<td>
</td>
<td>
1
</td>
<td>
2
</td>
<td>
â€¦
</td>
<td>
J
</td>
<td>
Sum
</td>
</tr>
<tr>
<td>
1
</td>
<td>
<span class="math inline">\(Pr(1|x_1,\beta)\)</span>
</td>
<td>
<span class="math inline">\(Pr(2|x_1,\beta)\)</span>
</td>
<td>
.
</td>
<td>
<span class="math inline">\(Pr(J|x_1,\beta)\)</span>
</td>
<td>
1
</td>
</tr>
<tr>
<td>
2
</td>
<td>
<span class="math inline">\(Pr(1|x_2,\beta)\)</span>
</td>
<td>
<span class="math inline">\(Pr(2|x_2,\beta)\)</span>
</td>
<td>
.
</td>
<td>
<span class="math inline">\(Pr(J|x_2,\beta)\)</span>
</td>
<td>
1
</td>
</tr>
<tr>
<td>
â€¦
</td>
<td>
.
</td>
<td>
.
</td>
<td>
.
</td>
<td>
.
</td>
<td>
.
</td>
</tr>
<tr>
<td>
N
</td>
<td>
<span class="math inline">\(Pr(1|x_S,\beta)\)</span>
</td>
<td>
<span class="math inline">\(Pr(2|x_S,\beta)\)</span>
</td>
<td>
.
</td>
<td>
<span class="math inline">\(Pr(J|x_S,\beta)\)</span>
</td>
<td>
1
</td>
</tr>
<tr>
<td>
Sum
</td>
<td>
n(1)
</td>
<td>
n(2)
</td>
<td>
</td>
<td>
n(J)
</td>
<td>
<span class="math inline">\(N_S\)</span>
</td>
</tr>
<tr>
<td>
Market share
</td>
<td>
n(1)/<span class="math inline">\(N_S\)</span>
</td>
<td>
n(2)/<span class="math inline">\(N_S\)</span>
</td>
<td>
</td>
<td>
n(J)/<span class="math inline">\(N_S\)</span>
</td>
<td>
1
</td>
</tr>
</tbody></table>
</section>
<section id="sample-enumeration-1" class="slide level2 smaller">
<h2>Sample Enumeration</h2>
<ul>
<li><p>Although there may be sampling error, the expected value should match the population average</p></li>
<li><p>For a â€˜Gâ€™ stratified sample: <span class="math display">\[\overset{\sim}{W_i} = \sum_{g=1}^G \left(\frac{N_g}{N_T}\right) \frac{1}{N_{sg}}\sum_{t=1}^{N_{sg}} Pr(j|X_t,\beta)\]</span></p></li>
<li><p>Here, <span class="math inline">\(N_g\)</span> is the population in segment <span class="math inline">\(g\)</span>, <span class="math inline">\(N_{sg}\)</span> is the sample population in segment <span class="math inline">\(g\)</span>, and <span class="math inline">\(N_T\)</span> is the target population</p></li>
<li><p>Sample for estimation should be representative</p></li>
<li><p>Sample enumeration can generally be used to test policies in the short-run during which the base population sample can be assumed to remain representative</p></li>
</ul>
</section>
<section id="naÃ¯ve-aggregation" class="slide level2 smaller">
<h2>NaÃ¯ve Aggregation</h2>
<ul>
<li>Considering mean value of <span class="math inline">\(X_t\)</span> as the unique value for whole population gives crude estimate
<table>
<tbody><tr>
<th>
Population Strata
</th>
<th colspan="5" style="text-align:center;">
Choice Alternatives
</th>
</tr>
<tr>
<td>
</td>
<td>
1
</td>
<td>
2
</td>
<td>
â€¦
</td>
<td>
J
</td>
<td>
Sum
</td>
</tr>
<tr>
<td>
Market share
</td>
<td>
<span class="math inline">\(Pr(1|x_1,\beta)\)</span>
</td>
<td>
<span class="math inline">\(Pr(2|x_1,\beta)\)</span>
</td>
<td>
.
</td>
<td>
<span class="math inline">\(Pr(J|x_1,\beta)\)</span>
</td>
<td>
1
</td>
</tr>
</tbody></table></li>
</ul>
</section>
<section id="classification-with-naÃ¯ve-aggregation" class="slide level2 smaller">
<h2>Classification with NaÃ¯ve Aggregation</h2>
<ul>
<li>Classify population into a number of strata and consider population within a particular segment as <strong>homogenous</strong> (having same attributes)</li>
<li>When sample enumeration infeasible, can use classification with naÃ¯ve aggregation</li>
<li>Categorization is based on attributes / market segmentation</li>
</ul>
<table>
<tbody><tr>
<th>
Population Strata
</th>
<th colspan="5" style="text-align:center;">
Choice Alternatives
</th>
</tr>
<tr>
<td>
</td>
<td>
1
</td>
<td>
2
</td>
<td>
â€¦
</td>
<td>
J
</td>
<td>
Sum
</td>
</tr>
<tr>
<td>
1
</td>
<td>
<span class="math inline">\(Pr(1|x_1,\beta)\)</span>
</td>
<td>
<span class="math inline">\(Pr(2|x_1,\beta)\)</span>
</td>
<td>
.
</td>
<td>
<span class="math inline">\(Pr(J|x_1,\beta)\)</span>
</td>
<td>
1
</td>
</tr>
<tr>
<td>
2
</td>
<td>
<span class="math inline">\(Pr(1|x_2,\beta)\)</span>
</td>
<td>
<span class="math inline">\(Pr(2|x_2,\beta)\)</span>
</td>
<td>
.
</td>
<td>
<span class="math inline">\(Pr(J|x_2,\beta)\)</span>
</td>
<td>
1
</td>
</tr>
<tr>
<td>
â€¦
</td>
<td>
.
</td>
<td>
.
</td>
<td>
.
</td>
<td>
.
</td>
<td>
.
</td>
</tr>
<tr>
<td>
n
</td>
<td>
<span class="math inline">\(Pr(1|x_S,\beta)\)</span>
</td>
<td>
<span class="math inline">\(Pr(2|x_S,\beta)\)</span>
</td>
<td>
.
</td>
<td>
<span class="math inline">\(Pr(J|x_S,\beta)\)</span>
</td>
<td>
1
</td>
</tr>
<tr>
<td>
Sum
</td>
<td>
n(1)
</td>
<td>
n(2)
</td>
<td>
</td>
<td>
n(J)
</td>
<td>
n
</td>
</tr>
<tr>
<td>
Market share
</td>
<td>
n(1)/n
</td>
<td>
n(2)/n
</td>
<td>
</td>
<td>
n(J)/n
</td>
<td>
1
</td>
</tr>
</tbody></table>
</section></section>
<section>
<section id="confidence-interval-on-predictions" class="title-slide slide level1 center">
<h1>Confidence Interval on Predictions</h1>

</section>
<section id="confidence-interval-on-predictions-1" class="slide level2 smaller">
<h2>Confidence Interval on Predictions</h2>
<ul>
<li>Estimated parameters are MVN distributed by central limit theorem</li>
<li>Same approach is applicable for any choice model <img data-src="../../../assets/images/teaching/ENCI707/Lecture5/ci_simulation.svg" class="quarto-figure quarto-figure-center"></li>
</ul>
</section>
<section id="confidence-interval-of-predictions-elasticity-market-share-revenue" class="slide level2">
<h2>Confidence Interval of Predictions: Elasticity, Market Share, &amp; Revenue</h2>

<img data-src="../../../assets/images/teaching/ENCI707/Lecture5/ci_prediction1.svg" class="quarto-figure quarto-figure-center r-stretch"></section>
<section id="confidence-interval-of-predictions-elasticity-market-share-revenue-1" class="slide level2">
<h2>Confidence Interval of Predictions: Elasticity, Market Share, Revenue</h2>

<img data-src="../../../assets/images/teaching/ENCI707/Lecture5/ci_prediction2.svg" class="quarto-figure quarto-figure-center r-stretch"></section>
<section id="confidence-interval-of-predictions-elasticity-market-share-revenue-2" class="slide level2">
<h2>Confidence Interval of Predictions: Elasticity, Market Share, &amp; Revenue</h2>

<img data-src="../../../assets/images/teaching/ENCI707/Lecture5/ci_market_share.svg" class="quarto-figure quarto-figure-center r-stretch"></section></section>
<section>
<section id="sampling-discrete-choice-models" class="title-slide slide level1 center">
<h1>Sampling &amp; Discrete Choice Models</h1>

</section>
<section id="sampling" class="slide level2 smaller">
<h2>Sampling</h2>
<ul>
<li>Sampling of choice makers from population using RP or SP survey:
<ul>
<li><strong>Exogenous Sample:</strong> Sample share of alternatives are:
<ul>
<li>Identical to those of population shares if representative</li>
<li>Not-identical if not representative</li>
</ul></li>
<li><strong>Endogenous/Choice-based Sample:</strong> Respondents are sampled based on observed choices
<ul>
<li>Sample share of alternatives are different from those of population shares</li>
</ul></li>
</ul></li>
<li><strong>Sampling of choice alternatives:</strong> irrespective of sampling of respondents:
<ul>
<li>Choice alternatives are collectively exhaustive</li>
<li>When choice alternative space is large, then sample alternatives</li>
</ul></li>
</ul>
</section>
<section id="sampling-of-choice-makers" class="slide level2 smaller">
<h2>Sampling of Choice Makers</h2>
<p><span class="math display">\[\text{Choice Model: }Pr(j|x,\beta)\]</span></p>
<ul>
<li>Exogenous sampling of choice makers (Stratified Random Sampling)
<ul>
<li>Population size, <span class="math inline">\(N\)</span></li>
<li>Stratification of population into total <span class="math inline">\(G\)</span> groups</li>
<li>Share (%) individual in a particular group, g in population, <span class="math inline">\(W_g\)</span></li>
<li>Sample size, <span class="math inline">\(n\)</span></li>
<li>Share (%) individual in the particular group, <span class="math inline">\(g\)</span> in sample, <span class="math inline">\(w_g\)</span></li>
<li>Probability of an individual being selected in the sample, <span class="math inline">\(q_g = \frac{w_g n}{W_g N}\)</span></li>
<li>Sampling probability is not a function of parameter, <span class="math inline">\(\beta\)</span></li>
</ul></li>
</ul>
</section>
<section id="sampling-of-choice-makers-1" class="slide level2 smaller">
<h2>Sampling of Choice Makers</h2>
<p><span class="math display">\[\text{Choice Model: }Pr(j|x,\beta)\]</span></p>
<ul>
<li>Exogenous sampling of choice makers (Simple Random Sampling)</li>
<li>Probability of an individual being selected in the sample, <span class="math inline">\(q_g = \frac{n}{N}\)</span></li>
<li>Sampling probability is not a function of parameter, <span class="math inline">\(\beta\)</span></li>
<li>For representative exogenous sample (stratified/simple random sampling) no correction to choice model estimates is needed
<ul>
<li>For non-representative sample, parameters except the Alternative Specific Constants (ASC) do not require correction</li>
<li>ASC needs to corrected/updated to match actual <strong>market share</strong></li>
</ul></li>
</ul>
</section>
<section id="sampling-of-choice-makers-2" class="slide level2 smaller">
<h2>Sampling of Choice Makers</h2>
<p><span class="math display">\[\text{Choice Model: }Pr(j|x(j),\beta)\]</span></p>
<ul>
<li>Endogenous/Choice-based sampling of choice makers (randomly select choice makers of specific choices)
<ul>
<li>Selection of respondent of specific choice maker group (e.g.&nbsp;transit users, driver, bicyclists) still should be random in some way</li>
<li>Choice model with choice-based sample produces <strong>unbiased estimates</strong> of all parameters except the Alternative Specific Constants (ASC)</li>
<li>ASCs need to corrected/updated to match actual <strong>market share</strong></li>
</ul></li>
</ul>
</section>
<section id="sampling-of-alternatives-large-choice-set" class="slide level2 smaller">
<h2>Sampling of alternatives: Large Choice Set</h2>
<ul>
<li>Large number of alternatives (e.g., destination location choice model), a random sample of alternatives can be used to estimate the model - where <span class="math inline">\(C = \text{full choice set}\)</span> and <span class="math inline">\(G = \text{subset of alternatives drawn from C}\)</span></li>
<li>Conditional probability of selecting a subset of alternatives <span class="math display">\[q(G|j) &gt; 0 \text{; if G includes the chosen alt. j}\]</span> <span class="math display">\[q(G|j) = 0 \text{; if G excludes the chosen alt. j}\]</span></li>
<li>Joint probability that <span class="math inline">\(J\)</span> is drawn with non-zero probability and <span class="math inline">\(j\)</span> is chosen by an individual <span class="math inline">\(i\)</span> <span class="math display">\[Pr(G,j) = q(G|j)Pr(G) = Pr(j|G)Q(G) \text{; (Bayes Theorem)}\]</span> <span class="math display">\[\text{Marginal probability: } Q(G) = \sum_{k \in C} Pr(k)q(G|k) \text{; (Sum over all possible subsets of j')}\]</span></li>
</ul>
</section>
<section id="sampling-of-alternatives-large-choice-set-1" class="slide level2 smaller">
<h2>Sampling of alternatives: Large Choice Set</h2>
<ul>
<li>Choice probability of alternative <span class="math inline">\(j\)</span> from subset: <span class="math display">\[Pr(j|G)Q(G) = q(G|j)Pr(j)\]</span> <span class="math display">\[Pr(j|G)Q(G) = \frac{Pr(j)q(G|j)}{Q(G)} = \frac{Pr(j)q(G|j)}{\sum_{k \in C} Pr(k)q(G|k)} = \frac{\exp(V_j)q(G|j)}{\sum_{k \in C} \exp(V_k)q(G|k)}\]</span></li>
<li>For any subset, <span class="math inline">\(q\)</span>, that does not include <span class="math inline">\(k\)</span>, <span class="math inline">\(q(G|k)=0\)</span>, so: <span class="math display">\[Pr(j|G) = \frac{\exp(V_j)q(G|j)}{\sum_{k \in G} \exp(V_k)q(G|k)} \text{; within C, any G without k drops out}\]</span> <span class="math display">\[Pr(j|G) = \frac{\exp(V_j)\exp(\ln(q(G|j)))}{\sum_{k \in G} \exp(V_k)\exp(\ln(q(G|j)))} = \frac{\exp(V_j + \ln(q(G|j)))}{\sum_{k \in G} \exp(V_k + \ln(q(G|j)))}\]</span></li>
</ul>
</section>
<section id="sampling-of-alternatives-large-choice-set-2" class="slide level2 smaller">
<h2>Sampling of alternatives: Large Choice Set</h2>
<ul>
<li>Choice model with sampling from the alternatives: <span class="math display">\[Pr(j|G) = \frac{\exp(V_j + ln(q(G|j)))}{\sum_{k \in G} \exp(V_k + ln(q(G|k)))} \text{; } q(G|j) = \prod_{l=1}^{G-1}Pr(l)\]</span></li>
<li>where <span class="math inline">\(Pr(l)\)</span> is the binary probability of drawing a choice</li>
<li>Under simple random sampling, samples are drawn <strong>uniformly with equal probability</strong></li>
<li>This makes the additional <span class="math inline">\(ln(q(G|j))\)</span> redundant (same for all alternative and so drops out: uniform conditional property) - MNL result becomes standard form</li>
<li><strong>Not true for other models</strong> such as nested logit, GEV, or mixed logit</li>
</ul>
</section>
<section id="managing-large-choice-sets" class="slide level2">
<h2>Managing Large Choice Sets</h2>
<ul>
<li>Reducing alternatives:
<ul>
<li>Use various feasibility constraints to reduce number of alternatives</li>
<li>Random sampling from large choice set</li>
<li>Wrong choice set may generate <strong>distorted predictions</strong></li>
</ul></li>
</ul>
</section></section>
<section>
<section id="transferability-and-updating-model-parameters-mnl" class="title-slide slide level1 center">
<h1>Transferability and Updating Model Parameters: MNL</h1>

</section>
<section id="model-transferability" class="slide level2 smaller">
<h2>Model Transferability</h2>
<ul>
<li>Transferability issues:
<ul>
<li>Systematic bias.</li>
<li>Local conditions.</li>
</ul></li>
<li>Model Updating Issues:
<ul>
<li>Systematic bias of the model is captured by model constants. - Alternative Specific Constants (ASC) are <strong>error basket</strong> - At a minimum level, the constant terms change from place-to-place</li>
<li><strong>Scale parameter</strong> of random error term changes from place-to-place</li>
<li><strong>Model specification</strong> changes from place-to-place</li>
</ul></li>
</ul>
</section>
<section id="updating-mnl-model-parameters" class="slide level2 smaller">
<h2>Updating MNL Model Parameters</h2>
<ul>
<li>MNL predictions matches the <strong>market shares of sample data used to estimate the model parameter</strong></li>
<li>Updating ASC of MNL for matching population shares if those are different (if the sample is not representative or model is transferred to a different spatial/temporal context) in sample share:</li>
<li><strong>Iterative ASC adjustment</strong> for the utility functions of the choice alternatives (including the based alternative for which the ASC is estimated to be 0) <span class="math display">\[ğ´ğ‘†ğ¶_{ğ‘¢ğ‘ğ‘‘ğ‘ğ‘¡ğ‘’ğ‘‘, j} = ğ´ğ‘†ğ¶_{ğ‘¡ğ‘œâˆ’ğ‘ğ‘’âˆ’ğ‘ğ‘‘ğ‘—ğ‘¢ğ‘ ğ‘¡ğ‘’ğ‘‘, j} + \ln\left(\frac{\text{actual market share, j}}{\text{predicted market share, j}} \right)
\]</span></li>
</ul>
</section>
<section id="updating-mnl-model-parameters-1" class="slide level2 smaller">
<h2>Updating MNL Model Parameters</h2>
<ul>
<li>Population market share of <span class="math inline">\(ğ‘—= ğ»_ğ‘—\)</span></li>
<li>Sample share of <span class="math inline">\(j = h_j\)</span></li>
<li>Adjustment proprtion of <span class="math inline">\(j = s_j - \frac{H_j}{h_j}\)</span></li>
<li>Adjusted choice probability <span class="math inline">\(Pr(j) = \frac{s_j \exp(\beta_{0,j}+\sum \beta x)}{\sum_k s_k \exp(\beta_{0,k}+\sum \beta x)}\)</span> <span class="math display">\[Pr(j) = \frac{\exp(\beta_{0,j}+\sum \beta x + \ln(s_j))}{\sum_k \exp(\beta_{0,k}+\sum \beta x + \ln(s_k))} = \frac{\exp(\beta_{0,j}+\sum \beta x + \ln(H_j/h_j))}{\sum_k \exp(\beta_{0,k}+\sum \beta x + \ln(H_k/h_k))}\]</span> <span class="math display">\[\text{Updated } \beta_{0,j} = (\beta_{0,j})_{estimated} + ln(H_j/h_j)\]</span></li>
</ul>
</section>
<section id="further-topics-among-many-others" class="slide level2">
<h2>Further topics (among many others)</h2>
<ul>
<li>Logit model with <strong>probabilistic choice set formation</strong></li>
<li>Logit model with <strong>multiple overlapping choice sets</strong></li>
<li>Logit model with <strong>myopic preferences regarding specific alternatives</strong></li>
</ul>


</section></section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<p><img src="../../../assets/images/teaching/ENCI707/logo.png" class="slide-logo"></p>
<div class="footer footer-default">
<p><a href="../../..\teaching/ENCI707/">ENCI707 Home</a></p>
</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../../../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../../../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../../../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../../../site_libs/revealjs/plugin/reveal-chalkboard/plugin.js"></script>
  <script src="../../../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../../../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../../../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../../../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../../../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleChalkboard(event)\"><kbd>b</kbd> Toggle Chalkboard</a></li>\n<li class=\"slide-tool-item\" data-item=\"6\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleNotesCanvas(event)\"><kbd>c</kbd> Toggle Notes Canvas</a></li>\n<li class=\"slide-tool-item\" data-item=\"7\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.downloadDrawings(event)\"><kbd>d</kbd> Download Drawings</a></li>\n<li class=\"slide-tool-item\" data-item=\"8\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'chalkboard': {"buttons":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'fade',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdn.jsdelivr.net/npm/mathjax@2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, RevealChalkboard, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
      window.document.addEventListener("DOMContentLoaded", function (event) {
        const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
        tabsets.forEach(function(tabset) {
          const tabby = new Tabby('#' + tabset.id);
        });
        const isCodeAnnotation = (el) => {
          for (const clz of el.classList) {
            if (clz.startsWith('code-annotation-')) {                     
              return true;
            }
          }
          return false;
        }
        const onCopySuccess = function(e) {
          // button target
          const button = e.trigger;
          // don't keep focus
          button.blur();
          // flash "checked"
          button.classList.add('code-copy-button-checked');
          var currentTitle = button.getAttribute("title");
          button.setAttribute("title", "Copied!");
          let tooltip;
          if (window.bootstrap) {
            button.setAttribute("data-bs-toggle", "tooltip");
            button.setAttribute("data-bs-placement", "left");
            button.setAttribute("data-bs-title", "Copied!");
            tooltip = new bootstrap.Tooltip(button, 
              { trigger: "manual", 
                customClass: "code-copy-button-tooltip",
                offset: [0, -8]});
            tooltip.show();    
          }
          setTimeout(function() {
            if (tooltip) {
              tooltip.hide();
              button.removeAttribute("data-bs-title");
              button.removeAttribute("data-bs-toggle");
              button.removeAttribute("data-bs-placement");
            }
            button.setAttribute("title", currentTitle);
            button.classList.remove('code-copy-button-checked');
          }, 1000);
          // clear code selection
          e.clearSelection();
        }
        const getTextToCopy = function(trigger) {
          const outerScaffold = trigger.parentElement.cloneNode(true);
          const codeEl = outerScaffold.querySelector('code');
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
        const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
          text: getTextToCopy
        });
        clipboard.on('success', onCopySuccess);
        if (window.document.getElementById('quarto-embedded-source-code-modal')) {
          const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
            text: getTextToCopy,
            container: window.document.getElementById('quarto-embedded-source-code-modal')
          });
          clipboardModal.on('success', onCopySuccess);
        }
          var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
          var mailtoRegex = new RegExp(/^mailto:/);
            var filterRegex = new RegExp("https:\/\/hawkins-tech-lab\.github\.io\/");
          var isInternal = (href) => {
              return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
          }
          // Inspect non-navigation links and adorn them if external
         var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
          for (var i=0; i<links.length; i++) {
            const link = links[i];
            if (!isInternal(link.href)) {
              // undo the damage that might have been done by quarto-nav.js in the case of
              // links that we want to consider external
              if (link.dataset.originalHref !== undefined) {
                link.href = link.dataset.originalHref;
              }
            }
          }
        function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
          const config = {
            allowHTML: true,
            maxWidth: 500,
            delay: 100,
            arrow: false,
            appendTo: function(el) {
                return el.closest('section.slide') || el.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'light-border',
            placement: 'bottom-start',
          };
          if (contentFn) {
            config.content = contentFn;
          }
          if (onTriggerFn) {
            config.onTrigger = onTriggerFn;
          }
          if (onUntriggerFn) {
            config.onUntrigger = onUntriggerFn;
          }
            config['offset'] = [0,0];
            config['maxWidth'] = 700;
          window.tippy(el, config); 
        }
        const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
        for (var i=0; i<noterefs.length; i++) {
          const ref = noterefs[i];
          tippyHover(ref, function() {
            // use id or data attribute instead here
            let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
            try { href = new URL(href).hash; } catch {}
            const id = href.replace(/^#\/?/, "");
            const note = window.document.getElementById(id);
            if (note) {
              return note.innerHTML;
            } else {
              return "";
            }
          });
        }
        const findCites = (el) => {
          const parentEl = el.parentElement;
          if (parentEl) {
            const cites = parentEl.dataset.cites;
            if (cites) {
              return {
                el,
                cites: cites.split(' ')
              };
            } else {
              return findCites(el.parentElement)
            }
          } else {
            return undefined;
          }
        };
        var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
        for (var i=0; i<bibliorefs.length; i++) {
          const ref = bibliorefs[i];
          const citeInfo = findCites(ref);
          if (citeInfo) {
            tippyHover(citeInfo.el, function() {
              var popup = window.document.createElement('div');
              citeInfo.cites.forEach(function(cite) {
                var citeDiv = window.document.createElement('div');
                citeDiv.classList.add('hanging-indent');
                citeDiv.classList.add('csl-entry');
                var biblioDiv = window.document.getElementById('ref-' + cite);
                if (biblioDiv) {
                  citeDiv.innerHTML = biblioDiv.innerHTML;
                }
                popup.appendChild(citeDiv);
              });
              return popup.innerHTML;
            });
          }
        }
      });
      </script>
    

</body></html>