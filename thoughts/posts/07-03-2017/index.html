<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jason Hawkins">
<meta name="dcterms.date" content="2017-07-03">

<title>AV Deployment, Urban DNA, and Equity – Hawkinslab</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../../assets/images/logo_tech.png" alt="TECH Group" class="navbar-logo">
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../team/index.html"> 
<span class="menu-text">Team</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../publications/index.html"> 
<span class="menu-text">Publications</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-teaching" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Teaching</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-teaching">    
        <li>
    <a class="dropdown-item" href="../../../teaching/CIVE461/index.html">
 <span class="dropdown-text">CIVE461/861</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../teaching/ENCI707/index.html">
 <span class="dropdown-text">ENCI707</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../teaching/Guest Lectures/CIVE990T.html">
 <span class="dropdown-text">CIVE990T</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-thoughts" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Thoughts</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-thoughts">    
        <li>
    <a class="dropdown-item" href="../../../thoughts/books.html">
 <span class="dropdown-text">Books</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../thoughts/blog.html">
 <span class="dropdown-text">Blog</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="../../../index.xml"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
        
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">AV Deployment, Urban DNA, and Equity</h1>
  <div class="quarto-categories">
    <div class="quarto-category">technology</div>
    <div class="quarto-category">autonomous vehicles</div>
    <div class="quarto-category">equity</div>
  </div>
  </div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Jason Hawkins </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">July 3, 2017</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p><em>Written before starting my Ph.D.&nbsp;in 2017 (July 03, 2017)…</em></p>
<p>Many questions arise for the transportation-land use modeller with the prospect of autonomous vehicles. Its effect on urban form will be heavily influenced by the manner in which it is implemented. It is probable AV will become a ubiquitous replacement of our current auto fleet, but may not be placed under personal ownership. One alternative would be a public fleet of vehicles. This has the advantage of being controlled by a single entity with a history of managing shared mobility services. Given the rapid emergence of the technology and its beginning in the private sector via automobile and technology firms, it is also likely for AV to be implemented as a set of competing services, similar to Uber and Lyft. This has advantages from the perspective of competition leading to innovation, but raises equity concerns. In addition, by placing the means of transport into private hands, there are concerns raised about privatization of infrastructure, etc. The final alternative would be a simple replacement of private automobiles, with personal ownership of each AV. These alternative implementations have the potential to influence the impact of AV on urban form.</p>
<p>My thoughts on this matter are concentrated on representing these alternative implementations in an integrated modelling framework. Do existing model frameworks have the capacity to model such changes, or are new methods required? The LUTI modelling field developed within a relatively stable transport system (i.e.&nbsp;the private automobile paradym). There is likely a need for increased dynamics in models. Rather than examining the impacts on demand of the introduction of a new interchange, we are interested in the changes in urban form resulting from a change in transportation supply and associated changes in demand. Alan Wilson is one of the founders of spatial interaction models and continues to develop innovative ideas with regards to dynamics in urban systems and their basic form. One of th concepts he considers is the idea of an urban ‘DNA’ and introduction of concepts from biological evolution into urban modelling. These types of concepts are critical in the development of models with the ability to consider seemingly large deviations from our current systems of transport. This requires a concept of fundamental rules of urban formation and growth to be operationalized in the model and not allowing oneself to be constrained by current transportation modes, etc.</p>
<p>One of the structures attributed to the introduction of the private automobile is urban sprawl, but to the history nerd this form appears long before. Without dipping too deep into history, we can see similar forms in the country estates of 18th century Britain. The ‘London Season’ was a time of the year when these nobles and other wealthy property owners would come into the city for a time to meet and put together marriages. We seem to have a natural, in our DNA, preference for solitude and personal space. Conversely, we also require proximity for social engagement, even with our rapidly developing communication technologies. Increased wealth among the middle classes has brought the ability to own a small ‘estate’ within the grasps of the every man, suggesting urban sprawl is not only a function of the automobile, but an ingrained desire that became possible through increased wealth. In the context of AV, I wonder what ingrained, DNA-based, desires and preferences will manifest themselves in our urban form. I perceive a need for better longitudinal data analysis, rather than close calibration to data from the current year. Rather than forcing the spatial structures of today onto the model, we should focus on dynamics and long-term trends. I have more confidence in the stability of the human mind than a concrete overpass with a 50 year design life, built 40 years ago. We must look to analogy in the phyical sciences in physics and biological DNA, but remember we humans are complex and dynamic systems. We should also be considering the latest concepts in economics and psychology. We must not allow ourselves to be pulled into the stream of past models, but let them guide us.</p>
<p><em>Written at the start of my Ph.D.&nbsp;(Nov.&nbsp;27, 2017)…</em></p>
<p>One aspect of AV, which has not be sufficiently assessed is the issue of social equity. Mobility is a key factor in determining social mobility (excuse the word-play) and there is strong evidence for transportation investment/quality being strongly correlated with the spatial distribution of income groups. In terms of transit usage, higher income groups tend to take fixed rail transit over bus. This has resulted in the subway map of many cities displaying a strong resemblance with income maps (see for example this CityLab article). Transportation comprises about 30% of household expenses for the poorest of North Americans.</p>
<p>This brings us to the case of AV. Some believe this innovation will be unequivocally good for equity. They expect vehicle prices to fall and anticipate implementation as a shared mobility-as-a-service system. The thinking is that the sharing of the cost of a ride will decrease the marginal cost of a trip and lower the access cost for lower income households. The cost of ownership will be shared between users and the removal of the driving task will drastically lower operating costs relative to taxis. This line of thinking is in contrast with some fundamental principles of economics that I will discuss below.</p>
<p>First, we must consider that this proposed service will have substantial sunk cost research associated with it. Technology development is expensive and we are not looking at a government agency, which will utilize tax revenues to pursue research for public benefit. These are large publically held corporations, with the mandate of maximizing shareholder revenue. Absent of government intervention via subsidies, initial AV trips will be expensive and available to the wealthy. Rudimentary microeconomics states that this is the path of any non-inferior good: consumption will increase with increasing available capital.</p>
<p>I would like to provide an example to structure the argument. Consider a vehicle with capacity for 5 occupants. A firm can choose to 1) charge $1 for each passenger in order to provide a service available to all residents of the city or 2) charge $4 for each passenger, knowing that a large segment of the population will be excluded from the service. In order for case 1 to govern, the firm must be certain of at least 4 passengers for each trip. As a risk averse agent, the firm will invariably decided to charge $4 knowing they only need to capture a single rider for each trip to break even with respect to case 1. Additional passengers will rapidly increase the profits of the firm beyond what could be provided under case 1. This brings us back to the issue of equity and its spatial component. If we assume that there is spatial segregation by income group (a very reasonable assumption), we can say that $4 trips will be concentrated in set of sub-regions within the city. We can consider a situation of $4 “trip signals” for a high income sub-region and $1 “trip signals” from a low income sub-region. The shared mobility operator, seeking to optimize their vehicle routing, will deploy the majority of their vehicles in areas where they can maximize their profits - a function of the demand for trips at the prevailing rate of service.</p>
<p>AV and mobility-as-a-service raise questions about willingness-to-pay and willingness-to-share. Absent government input, these services will act solely based on market forces. Current patterns of auto ownership and usage suggest people would be willing to pay a substantial premium to avoid vehicle sharing. In a culture of 1.20 vehicle occupancies, can we consider shared mobility as a likely outcome? Profit seeking private vehicle operators will have no qualms about circulating vehicles through upper income communities where the highest premium can be gained for each trip. This will exclude lower income households from use of the service. Lower operating costs does not necessarily mean that prices will drop. The price of a trip will be a function of the willingness-to-pay for each person and the number of persons who are willing to pay a given price, that is aggregate demand. It may be the case that operators can maintain sufficient ridership at high prices and not require a lower price to draw in additional ridership. Each vehicle will still constitute a capital cost and firms will seek to maximize unit (vehicle) profit and technology costs will be high for each vehicle.</p>
<p>I do not argue that prices will not come down eventually, but the risk is that during the period of partial AV penetration barriers will form that exclude, or inhibit, the adoption of this new mobility tool by lower income households. Consideration of equity in transportation and land use model forecasts will be critical in informing government policy to mitigate these effects. I have seen the effects of transportation on social exclusion through my travels in South America and even here in Canada and the United States. These considerations will be particularly important in developing cities, where government incentive structures may differ from what we see in North American cities. Work conducted with the PECAS model framework in Caracas, Venezuala has proven the ability of these tools to quantify the equity challenges of transportation policy. We need only examine the locations where AV testing is currently taking place to see the potential inequity in its service provision. Major testing is occuring in Palo Alto and other technology hubs, among Richard Florida’s Creative Class - engineers, software developers, and the like. AV adoption has the potential to alleviate issues of accessibility and inequity of access, but we cannot negate the possibility of it exacerbating these problems in an environment of market-driven mobility.</p>
<p>Some final thoughts on the topic: How will luxury services affect access to AV? There is the potential for segregation of the market and higher quality services made available to those who can afford them. As infrastructure evolves to meet the needs of AV, I question whether this evolution will occur uniformly through the city or be focused in higher income communities where residents have the social capital to influence policy and the financial capital to become early adopters of the technology.</p>
<p><em>Written during my Ph.D.&nbsp;(Nov.&nbsp;30, 2018)…</em> A great source of inspiration in my thinking this past year has been the podcast EconTalk with Russ Roberts. This week Russ spoke with the Political Economist Michael Munger about his new book “Tomorrow 3.0: Transaction Costs and the Sharing Economy” and, more generally, the sharing economy. Their discussion raised some questions for me around my own research in transportation and land use. Michael placed great emphasis on the importance of transaction costs, which include and bear a close resemblance to transportation costs and accessibility. Michael defines transactions costs into three, conveniently ‘t-suffixed’ words, namely: triangulation, transfer, and trust. He gives the case of the Sears catalogue as an early 20th century example of reducing transaction costs. The catalogue provided a medium for the aggregation of a wide variety of goods for sale. The Sears catalogue can be argued to be a predecessor of Amazon. Both represented major leaps forward in our ability to reduce transaction costs. The goods are provided in a centralized location (fulfilling triangulation), low cost in their distribution networks (transfer), and trusted by consumers. The ability to rate suppliers is a key ingredient in the success of Amazon and, focusing on the shared economy, the emergence of software that provides a means of trust in non-traditional market transactions. Consider Uber, which provides a service similar to hitchhiking in its lack of regulation. Users trust the service because Uber acts as an intermediary system of vetting for drivers.</p>
<p>Michael and Russ spend the first portion of the podcast talking about the sharing economy and the cost of durable goods. There are many goods we rarely use (e.g.&nbsp;power tools), which could be rented rather than owned. The main criteria for an effective shared durable good is that it have a high purchase price and low frequency of use. Michael provides an example of autonomous vehicles transporting rented equipment between homes, which is intriguing but also MIGHT presents challenges with respect to road congestion. I say might because it is not straightforward to compare individuals making purchases at the store with a centralized provider of goods, who can potentially optimize their route planning and carry many goods in a single vehicle. There are interesting questions around where the tradeoff lies between the cost of ownership and the cost of rental, including transportation costs.</p>
<p>One point that stood out for me in their discussion was the space requirement for durable goods. The primary examples are cars and large power tools. They discuss how space requirements for dwellings might be reduced by a diminished storage requirement within the home. Mind blown! It is so intuitive, but yet is not something I have considered at length. I am a great hoarder of books, which take up precious shelf space in our small apartment. The library is a (very) old example of the sharing economy in this particular space. I generally take advantage of this resource but the transaction costs are high for the cost of the good: I need to be sure the book is available at my local branch or reserve the book - requiring a wait for the satisfaction of reading a particular book. I’m often rough with my books, adding to my preference for ownership. None the less, it raises interesting questions about the reduction in building footprint associated with the shared ownership of cars, and perhaps other large durable goods.</p>
<p>Michael and Russ talk about Uber being a framework for sharing, well outside the transportation realm. I think this evolution is highly probable and it raises some fascinating questions for transportation and land use researchers. These are fundamentally questions of transportation, accessibility, proximity, and time - in the parlance of my field. It is an exciting time to begin in this field, indeed!</p>
<p>My usual notes on these topics: how will these new technologies affect equity? How can new technologies be framed in the context of networks? This is a topic I am ruminating on as a potential book idea. I have an enormous passion for history, which is largely untapped in my research. I have been thinking a lot about topics for a book that mix my interest in history with the perspective of a Transportation Engineer. We shall see where it leads…</p>



</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/hawkins-tech-lab\.github\.io\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="UNL-Hawkins-Lab/blogComment" data-repo-id="" data-category="Blog" data-category-id="" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script>
<input type="hidden" id="giscus-base-theme" value="light">
<input type="hidden" id="giscus-alt-theme" value="dark">
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Developed by Hawkinslab</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/UNL-Hawkins-Lab/Hawkinslab">
      <i class="bi bi-github" role="img" aria-label="Quarto GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>